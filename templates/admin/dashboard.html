{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container">
    <h1 class="neon-text mb-4" data-aos="fade-right">Admin Dashboard</h1>
    
    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3" data-aos="fade-up">
            <div class="glass-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted">Total Users</h6>
                        <h2 class="neon-text">{{ stats.total_users }}</h2>
                    </div>
                    <i data-feather="users" class="text-primary" style="width: 40px; height: 40px;"></i>
                </div>
            </div>
        </div>
        
        <div class="col-md-3" data-aos="fade-up" data-aos-delay="100">
            <div class="glass-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted">Service Providers</h6>
                        <h2 class="neon-text">{{ stats.total_providers }}</h2>
                    </div>
                    <i data-feather="briefcase" class="text-success" style="width: 40px; height: 40px;"></i>
                </div>
            </div>
        </div>
        
        <div class="col-md-3" data-aos="fade-up" data-aos-delay="200">
            <div class="glass-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted">Total Services</h6>
                        <h2 class="neon-text">{{ stats.total_services }}</h2>
                    </div>
                    <i data-feather="clipboard" class="text-warning" style="width: 40px; height: 40px;"></i>
                </div>
            </div>
        </div>
        
        <div class="col-md-3" data-aos="fade-up" data-aos-delay="300">
            <div class="glass-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted">Completed Bookings</h6>
                        <h2 class="neon-text">{{ stats.completed_bookings }}</h2>
                    </div>
                    <i data-feather="check-circle" class="text-info" style="width: 40px; height: 40px;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts -->
    <div class="row mb-4">
        <div class="col-md-6" data-aos="fade-up" data-aos-delay="400">
            <div class="glass-card">
                <h4 class="mb-4">Booking Trends</h4>
                <canvas id="bookingChart" height="200"></canvas>
            </div>
        </div>
        
        <div class="col-md-6" data-aos="fade-up" data-aos-delay="500">
            <div class="glass-card">
                <h4 class="mb-4">Popular Services</h4>
                <canvas id="servicesChart" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <!-- User Management -->
    <div class="glass-card mb-4" data-aos="fade-up" data-aos-delay="600">
        <h3 class="mb-4">User Management</h3>
        <div class="table-responsive">
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                        <tr>
                            <td>
                                <img src="{{ user.profile_image or 'https://images.unsplash.com/photo-1556745753-b2904692b3cd' }}" 
                                     alt="{{ user.name }}" 
                                     class="rounded-circle me-2"
                                     style="width: 30px; height: 30px; object-fit: cover;">
                                {{ user.name }}
                            </td>
                            <td>{{ user.email }}</td>
                            <td>
                                <span class="badge bg-{{ 'primary' if user.user_type == 'provider' else 'info' }}">
                                    {{ user.user_type }}
                                </span>
                            </td>
                            <td>
                                <span class="badge bg-{{ 'success' if user.is_active else 'danger' }}">
                                    {{ 'Active' if user.is_active else 'Inactive' }}
                                </span>
                            </td>
                            <td>
                                <a href="{{ url_for('admin.toggle_user', user_id=user.id) }}" 
                                   class="btn btn-sm {{ 'btn-danger' if user.is_active else 'btn-success' }}">
                                    {{ 'Deactivate' if user.is_active else 'Activate' }}
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Booking Trends Chart
const bookingCtx = document.getElementById('bookingChart').getContext('2d');
new Chart(bookingCtx, {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
            label: 'Bookings',
            data: [12, 19, 15, 25, 22, 30],
            borderColor: '#6c63ff',
            tension: 0.4
        }]
    },
    options: {
        plugins: {
            legend: {
                labels: {
                    color: '#fff'
                }
            }
        },
        scales: {
            y: {
                ticks: { color: '#fff' }
            },
            x: {
                ticks: { color: '#fff' }
            }
        }
    }
});

// Popular Services Chart
const servicesCtx = document.getElementById('servicesChart').getContext('2d');
new Chart(servicesCtx, {
    type: 'doughnut',
    data: {
        labels: ['Cleaning', 'Cooking', 'Gardening', 'Babysitting', 'Elder Care', 'Pet Care'],
        datasets: [{
            data: [30, 25, 15, 10, 12, 8],
            backgroundColor: ['#6c63ff', '#ff6b6b', '#ffd93d', '#6c5ce7', '#a8e6cf', '#ff8b94']
        }]
    },
    options: {
        plugins: {
            legend: {
                labels: {
                    color: '#fff'
                }
            }
        }
    }
});
</script>
{% endblock %}
